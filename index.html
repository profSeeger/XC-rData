<!DOCTYPE html>
<html>

<head>
    <title>Mapping API's: Leaflet - Layer Control</title>
    <meta name="description" content="Mapping API's: Leaflet - Layer Control" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
    <script src="classes/leaflet.ajax.js"></script>



    <style>
        html,
        body,
        #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }

		table {
		  font-family: arial, sans-serif;
		  border-collapse: collapse;
		  width: 100%;
		}

		td, th {
		  border: 1px solid #dddddd;
		  text-align: center;
		  padding: 1px;
		}

		tr:nth-child(even) {
		  background-color: #dddddd;
		}
</style>





</head>

<body>
    <div id="map"></div>


    <script>
        //Base Layers
        var OSM = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        });


		var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
});

        var nexrad = new L.tileLayer.wms("https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
            layers: 'nexrad-n0r',
            format: 'image/png',
            transparent: true,
            attribution: "Weather data &copy; 2015 IEM Nexrad"
        });




        //create the map
        var map = L.map('map', {
            center: new L.LatLng(42.7, -93.2),
            zoom: 7,
            layers: [OSM]
        });








function forEachFeature_district(feature, layer) {
        var popupContent = "<p> <b>" + feature.properties.location +
            "</b></br>Class: "+ feature.properties.class +"</p>";
        layer.bindPopup(popupContent);
    }


function forEachFeature_rank(feature, layer) {
        var popupContent = "<strong>" + feature.properties.teamName + "</strong><br>" +
        	"Enrollment: "+ feature.properties.enrollment + ", Class: "+ feature.properties.class + "<br>" +
        	"<table> <tr> <th>Week</th> <th>Girls</th> <th>Boys</th> </tr>" +
            "<tr><td>0: </td><td>" + feature.properties.rank0g + "</td><td>"+ feature.properties.rank0b + "</td></tr>" +
            "<tr><td>1: </td><td>" + feature.properties.rank1g + "</td><td>"+ feature.properties.rank1b + "</td></tr>" +
            "<tr><td>2: </td><td>" + feature.properties.rank2g + "</td><td>"+ feature.properties.rank2b + "</td></tr>" +
            "<tr><td>3: </td><td>" + feature.properties.rank3g + "</td><td>"+ feature.properties.rank3b + "</td></tr>" +
            "<tr><td>4: </td><td>" + feature.properties.rank4g + "</td><td>"+ feature.properties.rank4b + "</td></tr>" +
            "<tr><td>5: </td><td>" + feature.properties.rank5g + "</td><td>"+ feature.properties.rank5b + "</td></tr>" +
            "<tr><td>6: </td><td>" + feature.properties.rank6g + "</td><td>"+ feature.properties.rank6b + "</td></tr>" +
            "<tr><td>7: </td><td>" + feature.properties.rank7g + "</td><td>"+ feature.properties.rank7b + "</td></tr>" +
            "<tr><td>8: </td><td>" + feature.properties.rank8g + "</td><td>"+ feature.properties.rank8b + "</td></tr>" +
            "</table>";
        layer.bindPopup(popupContent);
}





function getColor(d) {
	return d > 15 ? 'Black' :
	       d > 10  ? 'Red' :
	       d > 5  ? 'Yellow' :
	       d > 0  ? 'Green' :

	                  '#fff';
}


/*

d > 15 ? '#800026' :
	       d > 12  ? '#BD0026' :
	       d > 10  ? '#E31A1C' :
	       d > 8  ? '#FC4E2A' :
	       d > 6   ? '#FD8D3C' :
	       d > 4   ? '#FEB24C' :
	       d > 2   ? '#FED976' :
	                  '#FFEDA0';



	*/





var districtMarkerOptions = {
    radius: 5,
    fillColor: "blue",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};


//feature.properties.rank2b

var rankingMarkerOptions = {
    radius: 8,
    fillColor: getColor(10),
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};







var districtMeets = new L.GeoJSON.AJAX("https://profseeger.github.io/XC-rData/districtSites2019.geojson", {
	onEachFeature: forEachFeature_district,
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, districtMarkerOptions);
    }
}).addTo(map);




var colorFilter = function (feature) {
if (feature.properties.rank2b !== "") return true}



var rankedSchools = new L.GeoJSON.AJAX("https://profseeger.github.io/XC-rData/schoolRankings.geojson", {
	 filter: colorFilter,
	onEachFeature: forEachFeature_rank,
    pointToLayer: function (feature, latlng) {
     return L.circleMarker(latlng, {
	     radius:6, //expressed in pixels
	      fillColor: getColor(feature.properties.rank2b),
			color: "#000", //black outline
			weight: 1, //outline width
			opacity: 1, //line opacity
			fillOpacity: 0.8
     });
    }
}).addTo(map);








        //layer control
        var baseMaps = {
            "OpenStreetMap": OSM,
            "ESRI Aerial": Esri_WorldImagery
        };

        var overlayMaps = {
            "Radar": nexrad,
            "District Sites": districtMeets,
            "Ranked Schools": rankedSchools

        };

        L.control.layers(baseMaps, overlayMaps).addTo(map);



       //map.fitBounds(rankedSchools .getBounds(), {padding: [2, 2]});



    </script>

</body>
</html>

